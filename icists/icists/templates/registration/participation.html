{% extends "registration/base.html" %}

{% block header %}
<link rel="stylesheet" href="{{ MEDIA_URL }}css/registration.css">
<link rel="stylesheet" href="{{ MEDIA_URL }}css/participation.css">
<script>	

    $(window).load(function() {
        var calc_price = function() {
            var krw = {{ krw }};
            var usd = {{ usd }};
            if ($("#accommodation").val() == 1) {
                krw += 135000;
                usd += 125;
            } else if ($("#accommodation").val() == 2) {
                krw += 180000;
                usd += 165;
            } else if ($("#accommodation").val() == 3) {
                krw += 120000;
                usd += 110;
            } else if ($("#accommodation").val() == 4) {
                krw += 112500;
                usd += 105
            } else if ($("#accommodation").val() == 5) {
                krw += 68000;
                usd += 65;
            }
            if ($("#breakfast:checked").val() == 'True') {
                krw += 20000;
                usd += 20;
            }
            if ($("#pretour:checked").val() == 'True') {
                krw += 40000;
                usd += 30;
            }
            if ($("#posttour:checked").val() == 'True') {
                krw += 100000;
                usd += 90;
            }
            $("#amt-krw").text(krw);
            $("#amt-usd").text(usd);
        }
        $(".alert").hide();
        $("#paypal").hide();
        $("#account").hide();
        $("#payment-option").on('change', function() {
            $(".alert").hide();
            if (this.value === "0") {
                $("#paypal").hide();
                $("#account").hide();
            } else if (this.value === "1") {
                $("#paypal").show();
                $("#account").hide();
            } else if (this.value === "2") {
                $("#paypal").hide();
                $("#account").show();
            }
        });
        $("#accommodation").on('change', function() {
            calc_price();
        });
        $("input[type=radio]").on('change', function() {
            calc_price();
        });
        $("#btn-submit").on('click', function(e) {
            e.preventDefault();
            $.ajax({
                type: "POST",
                url: "/registration/participation/",
                data: {
                    accommodation: $("select#accommodation").val(),
                    breakfast: $("#breakfast:checked").val(),
                    dietary: $("#dietary").text(),
                    pretour: $("#pretour:checked").val(),
                    posttour: $("#posttour:checked").val(),
                    payment: $("#payment-option").val(),
                    remitter: $("#remitter-name").val(),
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                }, 
                dataType: 'json',
                success: function(rsp) {
                    if (rsp.success) {
                        $(".alert-danger").hide();
                        $(".alert-success").show();
                        $("#application-information").hide();
                        $("#additional-information").hide();
                        $("#payment-information").show();
                    } else {
                        $(".alert-success").hide();
                        $(".alert-danger").show();
                        $("#application-information").show();
                        $("#additional-information").show();
                        $("#payment-information").show();
                        $("#msg-error").empty();
                        for (i in rsp.error) {
                            $("#msg-error").append(rsp.error[i] + '<br>');
                        }
                    }
                    $(".alert").alert();
                }
                
            });

        });
        $('select[name=accommodation-option]').val('{{ participant.accommodation_choice }}').attr("selected", "selected");
        $("input[name=breakfast-options][value='{{ participant.breakfast_option }}']").prop("checked", true);
        $("input[name=pretour-options][value='{{ participant.pretour }}']").prop("checked", true);
        $("input[name=posttour-options][value='{{ participant.posttour }}']").prop("checked", true);
		calc_price();
    });
</script>
{% endblock %}
{% block content %}
<div id="section-header">
    <h1>ICISTS-KAIST 2015</h1>
    <h3>Participant Additional Information Form</h3>
</div>
<div id="section-content">
    <div id="application-information">
        <label class="col-sm-4 col-label text-right">Application Category</label>
        <label>{{ category }}</label>
        <label>USD {{ usd }} / KRW {{ krw }}</label>
    </div>
    <form class="form-horizontal" action="/registration/participation/" method="post" enctype="multipart/form-data">
        <fieldset>
            <div id="additional-information">
                {% csrf_token %}
                <div class="form-group">
                    <label class="col-sm-4 control-label">Accommodation Option</label>
                    <div class="col-sm-8">
                        <select class="form-control col-sm-8" id="accommodation" name="accommodation-option" required="required">
                            <option value="0">-- Select --</option>
                            <option value="1">[Option A] Standard Ondol / Capacity: 4 people / Price: 125 USD (135,000 KRW)</option>
                            <option value="2">[Option B] Standard Ondol Twin / Capacity: 3 people / Price: 165 USD (180,000 KRW)</option>
                            <option value="3">[Option C] Deluxe Ondol / Capacity: 6 people / Price: 110 USD (120,000 KRW)</option>
                            <option value="4">[Option D] Suite Ondol / Capacity: 8 people (with 2 rooms of 4 people each) / Price: 105 USD (112,500 KRW)</option>
                            <option value="5">[Option E] KAIST Dormitory / Capacity: 3 people / Price: 65 USD (68,000 KRW)</option>
                            <option value="6">[Option F] No Accommodation needed</option>
                        </select>
                        <span class="help-block text-left">For more information, refer to the official website: <a href="http://www.icists.org/hotel-information/">http://www.icists.org/hotel-information/</a></span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-4 control-label">Breakfast</label>
                    <div class="col-sm-8 text-left">
                        <label class="radio-inline">
                            <input type="radio" id="breakfast" name="breakfast-options" value="True">Yes</input>
                        </label>
                        <label class="radio-inline">
                            <input type="radio" id="breakfast" name="breakfast-options" value="False">No</input>
                        </label>
                        <span class="help-block">USD 20 (KRW 20,000)</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-4 control-label">Dietary Preference</label>
                    <div class="col-sm-8">
                        <input type="text" class="form-control" id="dietary-option" id="dietary" name="dietary-option">
                    </div>

                    <span class="help-block">If HALAL, VEGAN or VEGETARIAN</span>
                </div>
                <div class="form-group">
                    <label class="col-sm-4 control-label">Pre-Conference Banquet Attendance</label>
                    <div class="col-sm-8 text-left">
                        <label class="radio-inline">
                            <input type="radio" id="pretour" name="pretour-options" value="True">Yes</input>
                        </label>
                        <label class="radio-inline">
                            <input type="radio" id="pretour" name="pretour-options" value="False">No</input>
                        </label>
                        <span class="help-block">USB 30 (KRW 40,000)</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-4 control-label">Post-Conference Tour Attendance</label>
                    <div class="col-sm-8 text-left">
                        <label class="radio-inline">
                            <input type="radio" id="posttour" name="posttour-options" value="True">Yes</input>
                        </label>
                        <label class="radio-inline">
                            <input type="radio" id="posttour" name="posttour-options" value="False">No</input>
                        </label>
                            <span class="help-block">USD 90 (KRW 100,000)</span>
                        </label>
                    </div>
                </div>
            </div>
            <div id="payment-information">
                <div class="form-group">
                    <label class="col-sm-4 control-label">Total Payment</label>
                    <span id="payment-amount" class="col-sm-8 text-right">USD <span id="amt-usd">{{ usd }}</span> / KRW <span id="amt-krw">{{ krw }}</span></span>
                </div>
                <div class="form-group">
                    <label class="col-sm-4 control-label">Payment Option</label>
                    <div class="col-sm-8">
                        <select id="payment-option" class="form-control" id="payment" name="payment-option" required="required">
                            <option value="0">-- Select --</option>
                            <option value="1">Paypal</option>
                            <option value="2">Bank Transfer</option>
                        </select>
                    </div>
                </div>
                <div id="placeholder" class="col-sm-4"></div>
                <div id="paypal" class="col-sm-8 text-left">
                    <div class="form-group">
                        <label class="col-sm-4 control-label">Paypal Account</label>
                        <p class="form-control-static">help@icists.org</p>
                    </div>
                </div>
                <div id="account" class="col-sm-8 text-left">
                    <div class="form-group">
                        <label class="col-sm-4 control-label">Bank Name</label>
                        <p class="form-control-static">Woori Bank</p>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">Branch Name</label>
                        <p class="form-control-static">KAIST SUBBRANCH</p>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">Account Number</label>
                        <p class="form-control-static">1002-953-865325</p>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">Name of Recipient</label>
                        <p class="form-control-static">권기량 (Ki Ryang Kwon)</p>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">Swift Code</label>
                        <p class="form-control-static">HVBKKRSEXXX</p>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">Remitter Name</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="remitter-name" name="remitter-name">
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-12">
                    <button id="btn-submit" type="button" class="btn btn-primary">Save</button>
                    <a class="btn btn-warning" href="/registration/">Back</a>
                </div>
            </div>
            <div class="alert alert-success">
                <a href="#" class="close" data-dismiss="alert">&times;</a>
                <strong>Success!</strong> Your additional information has been successfully saved.
				<br> Please make your payment as indicated above.
            </div>
            <div class="alert alert-danger">
                <a href="#" class="close" data-dismiss="alert">&times;</a>
                <strong>Failed!</strong><div id="msg-error"></div>
            </div>
        </fieldset>
    </form>
</div>
{% endblock %}
